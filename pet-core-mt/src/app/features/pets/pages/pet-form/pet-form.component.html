<div class="container-responsive py-10">
  <div class="mb-6">
    <button
      pButton
      label="Voltar"
      icon="pi pi-arrow-left"
      (click)="cancel()"
      class="mb-4 w-full sm:w-auto"
    ></button>
  </div>

  <div class="max-w-2xl mx-auto">
    <p-card>
      <ng-template pTemplate="header">
        <div class="p-4">
          <h1 class="text-3xl font-bold text-gray-900">
            {{ petId() ? 'Editar Pet' : 'Novo Pet' }}
          </h1>
        </div>
      </ng-template>

      @if (isLoading() && petId()) {
        <div class="text-center py-12">
          <p class="text-gray-600">Carregando dados do pet...</p>
        </div>
      } @else {
        <form [formGroup]="petForm" (ngSubmit)="onSubmit()" class="space-y-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="space-y-2">
              <label for="nome" class="field-label">
                Nome <span class="text-red-500">*</span>
              </label>
              <input
                id="nome"
                type="text"
                pInputText
                formControlName="nome"
                class="w-full"
                [class.border-red-500]="petForm.get('nome')?.invalid && petForm.get('nome')?.touched"
                placeholder="Digite o nome do pet"
              />
              @if (petForm.get('nome')?.invalid && petForm.get('nome')?.touched) {
                <span class="field-error">
                  @if (petForm.get('nome')?.errors?.['required']) {
                    Nome é obrigatório
                  }
                </span>
              }
            </div>

            <div class="space-y-2">
              <label for="raca" class="field-label">
                Raça <span class="text-red-500">*</span>
              </label>
              <input
                id="raca"
                type="text"
                pInputText
                formControlName="raca"
                class="w-full"
                [class.border-red-500]="petForm.get('raca')?.invalid && petForm.get('raca')?.touched"
                placeholder="Digite a raça do pet"
              />
              @if (petForm.get('raca')?.invalid && petForm.get('raca')?.touched) {
                <span class="field-error">
                  @if (petForm.get('raca')?.errors?.['required']) {
                    Raça é obrigatória
                  }
                </span>
              }
            </div>

            <div class="space-y-2 md:col-span-2">
              <label for="idade" class="field-label">Idade</label>
              <input
                id="idade"
                type="number"
                pInputText
                formControlName="idade"
                min="0"
                placeholder="Digite a idade em anos"
                class="w-full"
                [class.border-red-500]="petForm.get('idade')?.invalid && petForm.get('idade')?.touched"
              />
              @if (petForm.get('idade')?.invalid && petForm.get('idade')?.touched) {
                <span class="field-error">
                  @if (petForm.get('idade')?.errors?.['min']) {
                    Idade deve ser maior ou igual a 0
                  }
                </span>
              }
            </div>

            <div class="space-y-2 md:col-span-2">
              <label for="foto" class="field-label">Foto</label>
              <div class="flex flex-col gap-4">
                @if (previewUrl()) {
                  <div class="w-full h-64 bg-gray-200 rounded-xl overflow-hidden ring-1 ring-gray-200">
                    <img [src]="previewUrl()" alt="Preview" class="w-full h-64 object-cover" />
                  </div>
                  @if (selectedFile()) {
                    <button
                      type="button"
                      pButton
                      label="Remover foto selecionada"
                      icon="pi pi-trash"
                      class="p-button-text p-button-danger w-full sm:w-auto"
                      (click)="clearSelectedPhoto()"
                      [disabled]="isLoading() || isUploading()"
                    ></button>
                  } @else if (petId() && currentPhotoId()) {
                    <button
                      type="button"
                      pButton
                      label="{{ removeCurrentPhotoOnSave() ? 'Desfazer remoção' : 'Remover foto' }}"
                      icon="pi pi-trash"
                      class="p-button-text p-button-danger w-full sm:w-auto"
                      (click)="toggleRemoveCurrentPhoto()"
                      [disabled]="isLoading() || isUploading()"
                    ></button>
                  }
                }
                <input
                  id="foto"
                  type="file"
                  accept="image/*"
                  (change)="onFileSelected($event)"
                  class="file-input"
                  #fotoInput
                />
              </div>
            </div>
          </div>

          <div class="flex flex-col-reverse sm:flex-row gap-3 justify-end pt-4">
            <button
              type="button"
              pButton
              label="Cancelar"
              (click)="cancel()"
              [disabled]="isLoading() || isUploading()"
              class="p-button-secondary w-full sm:w-auto"
            ></button>
            <button
              type="submit"
              pButton
              label="{{ isLoading() || isUploading() ? 'Salvando...' : 'Salvar' }}"
              [disabled]="petForm.invalid || isLoading() || isUploading()"
              class="w-full sm:w-auto"
            ></button>
          </div>
        </form>
      }
    </p-card>
  </div>
</div>
